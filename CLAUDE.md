# Dropdown Panel Web Component

## Project Overview

This is a lightweight, accessible dropdown/popover web component library built with vanilla JavaScript and Web Components API. It provides both compact popover-style dropdowns and full-width mega menu layouts.

**Philosophy: Minimal Styling**

The component includes only essential functional CSS. This makes it:

- Easy to integrate into any project
- No opinionated styles to override
- Lightweight - under 1KB of CSS (962 bytes minified)
- Works with Tailwind, Bootstrap, CSS-in-JS, or plain CSS

Users add their own styling (colors, shadows, animations, spacing).

## Architecture

### Component Structure

The library consists of three custom elements that work together:

1. **`<dropdown-component>`** - Main container that orchestrates behavior
2. **`<dropdown-trigger>`** - Button element that toggles the dropdown
3. **`<dropdown-panel>`** - Content container that can be either popover or full-width

### File Structure

```
src/
├── index.js                          # Main entry point, registers all components
├── dropdown-component.scss           # All styles for the component
└── components/
    ├── dropdown-component.js         # Main orchestrator component
    ├── dropdown-trigger.js           # Trigger button component
    └── dropdown-panel.js             # Panel/content container component

demo/
└── index.html                        # Demo page with examples

dist/                                 # Built files (generated by rollup)
├── dropdown-panel.esm.js            # ES module build
├── dropdown-panel.cjs.js            # CommonJS build
├── dropdown-panel.min.js            # Minified UMD build
└── dropdown-panel.min.css           # Compiled CSS
```

## Usage Examples

### Basic Popover Dropdown (Default)

```html
<dropdown-component>
	<dropdown-trigger>Menu</dropdown-trigger>
	<dropdown-panel>
		<a href="#" class="dropdown-item">Profile</a>
		<a href="#" class="dropdown-item">Settings</a>
		<div class="dropdown-divider"></div>
		<a href="#" class="dropdown-item">Logout</a>
	</dropdown-panel>
</dropdown-component>
```

**Behavior:**

- Panel positioned absolutely relative to the dropdown-component
- Smooth animation with blur, scale, and transform effects
- Minimum width of 180px
- Has border-radius for rounded corners

### Full-Width Mega Menu

```html
<dropdown-component>
	<dropdown-trigger>Products</dropdown-trigger>
	<dropdown-panel wide>
		<div class="column">
			<h3>Software</h3>
			<a href="#" class="dropdown-item">Web Apps</a>
			<a href="#" class="dropdown-item">Mobile Apps</a>
		</div>
		<div class="column">
			<h3>Hardware</h3>
			<a href="#" class="dropdown-item">Laptops</a>
			<a href="#" class="dropdown-item">Desktops</a>
		</div>
	</dropdown-panel>
</dropdown-component>
```

**Behavior:**

- Panel spans full width (100%) of parent
- No blur or scale animations (simpler fade-in)
- No border-radius (flush with container)
- Parent dropdown-component gets `position: static`

### Nested Dropdowns

The component supports nested dropdowns inside panel content. Use `opens="right"` for submenus:

```html
<dropdown-component>
	<dropdown-trigger>Resources</dropdown-trigger>
	<dropdown-panel>
		<a href="#">Documentation</a>

		<!-- Nested dropdown opens to the right -->
		<dropdown-component>
			<dropdown-trigger>Support</dropdown-trigger>
			<dropdown-panel opens="right">
				<a href="#">Contact Us</a>
				<a href="#">Help Center</a>
				<a href="#">FAQ</a>
			</dropdown-panel>
		</dropdown-component>

		<a href="#">Blog</a>
	</dropdown-panel>
</dropdown-component>
```

**Important:** CSS selectors use `>` child combinator to only affect direct children, not nested components.

## Key Design Decisions

### 1. Single Panel Component with `wide` Attribute

**Decision:** Use one `<dropdown-panel>` component with an optional `wide` attribute instead of two separate components (`<dropdown-panel>` and `<dropdown-menu>`).

**Rationale:**

- Simpler API - one component instead of two
- They're fundamentally the same thing with different CSS
- Easier to maintain and extend
- More semantic - the attribute describes the layout variant

**Implementation:**

```javascript
// In dropdown-component.js connectedCallback()
if (_.panel.hasAttribute('wide')) {
	_.style.position = 'static'; // Full-width layout
} else {
	_.style.position = 'relative'; // Popover layout
}
```

### 2. No ARIA Menu Roles

**Decision:** Do NOT use `role="menu"`, `role="menubar"`, or `role="menuitem"` on the dropdown elements.

**Rationale:**
Following [Adrian Roselli's accessibility guidance](https://adrianroselli.com/2017/10/dont-use-aria-menu-roles-for-site-nav.html):

- These roles are for application menus (File/Edit in desktop apps), not website navigation
- They create expectations for complex keyboard interactions that aren't typically implemented
- Screen readers announce them as "application menus" which confuses users
- Can make navigation LESS accessible when misused

**What we DO use:**

- `role="button"` on `<dropdown-trigger>` (it acts as a button)
- `aria-expanded` on trigger (true/false state)
- `aria-controls` on trigger (points to panel ID)
- `aria-hidden` on panel (true/false state)
- `aria-labelledby` on panel (points back to trigger)

### 3. Direct Child Selectors in CSS

**Decision:** Use `>` child combinator in hover selectors.

**Rationale:**
Prevents styles from affecting nested dropdowns inside panel content.

```scss
// ✓ Correct - only affects direct children
dropdown-component:hover > dropdown-panel

// ✗ Wrong - would affect nested panels too
dropdown-component:hover dropdown-panel
```

### 4. Direction Control with `opens` Attribute

**Decision:** Use `opens="right"` attribute to control panel opening direction.

**Rationale:**

- Enables nested menus that open to the right
- Value-based attribute is extensible (could add "left", "up" in future)
- Default behavior (opens down) requires no attribute
- Creates appropriate hover bridge for each direction

**Implementation:**

```scss
// Right-opening panels position to the right
dropdown-panel[opens='right'] {
	top: 0;
	left: 100%;
}

// Horizontal bridge for right-opening panels
dropdown-component:has(> dropdown-panel[opens='right']):hover
	> dropdown-trigger::before {
	left: 50%;
	top: -10px;
	width: 30px;
	height: calc(100% + 20px);
	transform: perspective(50px) rotateY(-50deg);
}
```

## Component Communication

### How Components Work Together

1. **On mount** (`dropdown-component.connectedCallback`):

   - Finds direct child `<dropdown-trigger>` and `<dropdown-panel>`
   - Checks for `wide` attribute and sets positioning
   - Assigns IDs if needed
   - Sets up ARIA relationships
   - Adds event listeners

2. **User hovers on dropdown-component**:

   - `mouseenter` event triggers `show()` method
   - Sets `aria-expanded="true"` on trigger
   - Sets `aria-hidden="false"` on panel
   - CSS transitions make panel visible

3. **User leaves dropdown-component**:

   - `mouseleave` event triggers `hide()` method
   - Reverses ARIA states
   - CSS transitions hide panel

4. **Keyboard interaction**:
   - Enter/Space on trigger toggles panel
   - Escape closes current panel only (uses `event.stopPropagation()` to prevent closing parent menus)
   - Focus returns to trigger when panel closes
   - Progressive disclosure: nested menus close one level at a time

### Event Flow

```
User Action → dropdown-component listens → Calls show()/hide()
                                         ↓
                            Updates ARIA attributes
                                         ↓
                            CSS responds to [aria-hidden] changes
                                         ↓
                            Panel animates in/out
```

## Styling System

### Minimal Functional Styles

The component includes ONLY the CSS required for functionality:

```scss
// Component display
dropdown-component {
	display: inline-block;
}

// Trigger basics
dropdown-trigger {
	position: relative; // Needed for hover bridge
	cursor: pointer;
	user-select: none;
}

// Hover bridge - invisible area between trigger and panel
dropdown-component:hover > dropdown-trigger::before,
dropdown-trigger[aria-expanded='true']::before {
	content: '';
	position: absolute;
	left: -10px;
	top: 50%;
	width: calc(100% + 20px);
	height: 30px;
	transform: perspective(50px) rotateX(50deg);
	z-index: 10;
}

// Panel positioning (default - opens downward)
dropdown-panel {
	position: absolute;
	top: 100%;
	left: 0;
	opacity: 0;
	pointer-events: none;
}

// Right-opening panels (for nested menus)
dropdown-panel[opens='right'] {
	top: 0;
	left: 100%;
}

// Wide variant (full-width mega menu)
dropdown-panel[wide] {
	width: 100%;
}

// Visible states
dropdown-component:hover > dropdown-panel,
dropdown-panel[aria-hidden='false'] {
	opacity: 1;
	pointer-events: auto;
	visibility: visible;
}
```

### User Styling

Users must add their own styles for:

- Colors and backgrounds
- Shadows and borders
- Padding and margins
- Z-index (except hover bridge)
- Animations and transitions
- Border-radius
- Typography

See `demo/index.html` for complete styling examples.

## Build System

### Commands

```bash
npm run build       # Build all dist files
npm run dev         # Watch mode for development
npm run lint        # Run ESLint
npm run format      # Format with Prettier
```

### Rollup Configuration

Builds 4 output formats:

1. **ESM** - `dist/dropdown-panel.esm.js` (modern import/export)
2. **CJS** - `dist/dropdown-panel.cjs.js` (Node.js require)
3. **UMD** - `dist/dropdown-panel.js` (browser global)
4. **Minified UMD** - `dist/dropdown-panel.min.js` (production)

Plus CSS outputs:

- `dist/dropdown-panel.css` (expanded)
- `dist/dropdown-panel.min.css` (minified)
- `dist/dropdown-panel.scss` (source)

## Common Styling Patterns

### Basic Panel Styling

```css
dropdown-panel {
	background: white;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
	border-radius: 8px;
	padding: 0.5rem 0;
	min-width: 200px;
	z-index: 1000;
	/* Important: Avoid overflow: hidden - it will clip nested panels */
}
```

### Right-Aligned Popover

```css
dropdown-panel {
	left: auto;
	right: 0;
}
```

### Animated Entrance

```css
dropdown-panel:not([wide]) {
	transform: translateY(10px) scale(0.95);
	transition: all 200ms ease-out;
}

dropdown-component:hover > dropdown-panel:not([wide]),
dropdown-panel:not([wide])[aria-hidden='false'] {
	transform: translateY(0) scale(1);
}
```

### Grid Layout for Wide Panels

```css
dropdown-panel[wide] {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 2rem;
	padding: 2rem;
	background: white;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
```

### Tailwind Example

```html
<dropdown-component>
	<dropdown-trigger class="px-4 py-2 bg-blue-600 text-white rounded">
		Menu
	</dropdown-trigger>
	<dropdown-panel
		class="bg-white rounded-lg shadow-lg p-2 min-w-[200px] z-50">
		<a href="#" class="block px-4 py-2 hover:bg-gray-100 rounded"
			>Item</a
		>
	</dropdown-panel>
</dropdown-component>
```

### Nested Dropdown Indicators

Add visual indicators using HTML elements (not CSS pseudo-elements, which can block the hover bridge):

```html
<!-- Main dropdown with down arrow -->
<dropdown-trigger>
	Products
	<span class="dropdown-arrow">
		<svg viewBox="0 0 12 12" fill="currentColor">
			<path d="M6 8L2 4h8z" />
		</svg>
	</span>
</dropdown-trigger>

<!-- Nested dropdown with right arrow -->
<dropdown-trigger class="dropdown-item">
	Support
	<span class="dropdown-arrow">
		<svg viewBox="0 0 12 12" fill="currentColor">
			<path d="M8 6L4 2v8z" />
		</svg>
	</span>
</dropdown-trigger>
```

**Important:** Don't use `::after` pseudo-elements for dropdown arrows - they interfere with the hover bridge functionality.

## Testing the Demo

The `demo/index.html` file provides a live example:

```bash
npm run dev  # Starts dev server at http://localhost:10001
```

The demo shows:

- Navigation bar with both popover and wide panels
- Interactive hover/click behavior
- Keyboard navigation
- Multiple dropdown instances

## Future Enhancements

Potential features to add:

1. **Position attribute**: `<dropdown-panel position="right">` for alignment
2. **Offset attribute**: `<dropdown-panel offset="10px">` for custom spacing
3. **Click-only mode**: Disable hover, only toggle on click
4. **Animation options**: Different animation styles via attributes
5. **Auto-close on click outside**: Option to close when clicking outside
6. **Mobile drawer mode**: Convert to bottom sheet on mobile devices

## Debugging Tips

### Panel not showing?

1. Check console for warning: "dropdown-component requires <dropdown-trigger> and <dropdown-panel> as direct children"
2. Ensure trigger and panel are direct children of dropdown-component
3. Check if panel has `aria-hidden="false"` when opened (inspect element)

### Nested dropdowns interfering?

1. Make sure CSS uses `>` child combinators
2. Check that hover events aren't bubbling incorrectly

### Styles not applying?

1. Ensure CSS is imported: `import '@magic-spells/dropdown-panel/css'`
2. Remember: the component is unstyled by default - you need to add your own styles
3. Check if you're targeting the right selectors (use browser DevTools)
4. For animations, make sure you're targeting both the hidden and visible states

### Hover bridge not working?

1. **Don't use `::before` or `::after` pseudo-elements on `dropdown-trigger`** - they block the invisible hover bridge
2. Use real HTML elements (`<span>`) for dropdown indicators instead
3. See the demo for examples using SVG arrows in `<span>` elements

## Version History

- **v0.3.0** (upcoming) - Major update: Minimal styling & nested dropdown support

  - **BREAKING:** Removed all opinionated styles (colors, shadows, animations, spacing)
  - Now ships with only functional CSS under 1KB (962 bytes minified)
  - Easy to integrate into any project (works with Tailwind, CSS-in-JS, etc.)
  - Added `opens="right"` attribute for nested dropdown menus
  - Fixed keyboard navigation: Escape key uses `stopPropagation()` for progressive menu closure
  - Added hover bridge support for right-opening panels
  - Documented SVG arrow approach (avoiding pseudo-elements that block hover bridge)
  - Removed `overflow: hidden` to support nested panels
  - Updated all documentation with 2-space indentation for GitHub
  - Moved example styles to demo for reference
  - Added `.prettierignore` for markdown files

- **v0.2.2** - Refactored to single `<dropdown-panel>` component with `wide` attribute
  - Removed `<dropdown-menu>` component
  - Removed ARIA menu roles per accessibility best practices
  - Added direct child selectors to prevent nested dropdown issues
  - Fixed export bug (DropdownMenu was imported but not exported)

## Publishing Checklist

Before publishing to npm:

1. Update version in `package.json`
2. Run `npm run build` to regenerate dist files
3. Run `npm run lint` to check for errors
4. Test demo locally with `npm run dev`
5. Update README.md with any API changes
6. Commit all changes
7. Create git tag: `git tag v0.x.x`
8. Push with tags: `git push --tags`
9. Run `npm publish` (requires npm auth)

## Notes for Future Development

- The component uses `Date.now()` for generating unique IDs. Consider using a more robust ID generator if needed.
- The `inert` attribute is used for hiding panels. Ensure polyfill for older browsers if needed.
- Focus management could be enhanced to trap focus within open panels.
- Consider adding RTL (right-to-left) language support.
